const purgecss = require('@fullhuman/postcss-purgecss').default;

module.exports = {
  plugins: [
    require('tailwindcss'),
    require('autoprefixer'),
    ...(process.env.NODE_ENV === 'production' ? [
      purgecss({
        content: [
          './views/**/*.hbs',
          './assets/js/**/*.js',
          './routes/**/*.js',
          './middleware/**/*.js',
          './services/**/*.js',
          './server.js',
          './public/**/*.html'
        ],
        defaultExtractor: content => content.match(/[\w-/:]+(?<!:)/g) || [],
        safelist: [
          // 保留动态生成的类名
          /^bg-/,
          /^text-/,
          /^border-/,
          /^hover:/,
          /^focus:/,
          /^dark:/,
          /^lg:/,
          /^md:/,
          /^sm:/,
          /^xl:/,
          /^2xl:/,
          /^animate-/,
          /^transition-/,
          /^transform-/,
          /^scale-/,
          /^rotate-/,
          /^translate-/,
          /^opacity-/,
          /^shadow-/,
          /^rounded-/,
          /^p-/,
          /^m-/,
          /^w-/,
          /^h-/,
          /^flex/,
          /^grid/,
          /^col-/,
          /^row-/,
          /^gap-/,
          /^space-/,
          /^justify-/,
          /^items-/,
          /^self-/,
          /^order-/,
          /^z-/,
          /^relative/,
          /^absolute/,
          /^fixed/,
          /^sticky/,
          /^top-/,
          /^bottom-/,
          /^left-/,
          /^right-/,
          /^overflow-/,
          /^cursor-/,
          /^select-/,
          /^resize-/,
          /^appearance-/,
          /^outline-/,
          /^ring-/,
          /^blur-/,
          /^brightness-/,
          /^contrast-/,
          /^drop-shadow-/,
          /^grayscale-/,
          /^hue-rotate-/,
          /^invert-/,
          /^saturate-/,
          /^sepia-/,
          /^backdrop-/,
          /^from-/,
          /^to-/,
          /^via-/,
          /^bg-gradient-/,
          /^text-gradient-/,
          /^border-gradient-/,
          /^divide-/,
          /^placeholder-/,
          /^caret-/,
          /^accent-/,
          /^scroll-/,
          /^snap-/,
          /^touch-/,
          /^will-change-/,
          /^contain-/,
          /^break-/,
          /^hyphens-/,
          /^whitespace-/,
          /^leading-/,
          /^tracking-/,
          /^font-/,
          /^not-/,
          /^first:/,
          /^last:/,
          /^odd:/,
          /^even:/,
          /^visited:/,
          /^target:/,
          /^open:/,
          /^default:/,
          /^checked:/,
          /^indeterminate:/,
          /^placeholder-shown:/,
          /^autofill:/,
          /^required:/,
          /^valid:/,
          /^invalid:/,
          /^in-range:/,
          /^out-of-range:/,
          /^read-only:/,
          /^read-write:/,
          /^empty:/,
          /^before:/,
          /^after:/,
          /^marker:/,
          /^selection:/,
          /^file:/,
          /^backdrop:/,
          /^supports:/,
          /^data:/,
          /^aria:/,
          /^group/,
          /^peer/,
          /^group-hover:/,
          /^group-focus:/,
          /^group-active:/,
          /^group-disabled:/,
          /^group-visited:/,
          /^group-checked:/,
          /^group-focus-within:/,
          /^group-focus-visible:/,
          /^group-target:/,
          /^group-open:/,
          /^group-default:/,
          /^group-required:/,
          /^group-valid:/,
          /^group-invalid:/,
          /^group-in-range:/,
          /^group-out-of-range:/,
          /^group-read-only:/,
          /^group-read-write:/,
          /^group-empty:/,
          /^group-before:/,
          /^group-after:/,
          /^group-placeholder-shown:/,
          /^group-autofill:/,
          /^group-indeterminate:/,
          /^group-aria:/,
          /^group-data:/,
          /^peer-hover:/,
          /^peer-focus:/,
          /^peer-active:/,
          /^peer-disabled:/,
          /^peer-visited:/,
          /^peer-checked:/,
          /^peer-focus-within:/,
          /^peer-focus-visible:/,
          /^peer-target:/,
          /^peer-open:/,
          /^peer-default:/,
          /^peer-required:/,
          /^peer-valid:/,
          /^peer-invalid:/,
          /^peer-in-range:/,
          /^peer-out-of-range:/,
          /^peer-read-only:/,
          /^peer-read-write:/,
          /^peer-empty:/,
          /^peer-before:/,
          /^peer-after:/,
          /^peer-placeholder-shown:/,
          /^peer-autofill:/,
          /^peer-indeterminate:/,
          /^peer-aria:/,
          /^peer-data:/,
          // 保留自定义组件类
          'btn',
          'btn-primary',
          'btn-secondary',
          'btn-outline',
          'input',
          'card',
          'card-header',
          'card-title',
          'card-subtitle',
          'badge',
          'badge-success',
          'badge-warning',
          'badge-error',
          'badge-info',
          'nav-link',
          'nav-link-active',
          'nav-link-inactive',
          'sidebar',
          'sidebar-mobile',
          'sidebar-open',
          'overlay',
          'modal',
          'modal-content',
          'modal-dialog',
          'loading-spinner',
          'fade-in',
          'slide-up',
          'bounce-in',
          'text-balance',
          'scrollbar-hide',
          'gradient-text'
        ]
      }),
      require('cssnano')({
        preset: ['default', {
          discardComments: {
            removeAll: true,
          },
          normalizeWhitespace: true,
          colormin: true,
          minifyFontValues: true,
          minifySelectors: true,
        }]
      })
    ] : [])
  ]
} 